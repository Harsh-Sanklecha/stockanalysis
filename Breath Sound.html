<!DOCTYPE html>
<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
<script src="https://unpkg.com/ml5@0.4.3/dist/ml5.min.js"></script>

  <meta charset="utf-8" />
<style>
body {
 background-color: lightblue;
   background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: cover;
}
h2{font-size:44px;}
h3{font-size:35px;}

</style>
</head>

<body>
  <script> 
  let label = "waiting...";

// Classifier and model url
let classifier;
let modelURL = 'https://teachablemachine.withgoogle.com/models/z-nWfQWiC/';
// STEP 1: Load the model!

  classifier = ml5.soundClassifier(modelURL + 'model.json');
function setup() { 

  classifyAudio();
	noLoop();
}

// STEP 2 classify!
function classifyAudio() {
  classifier.classify(gotResults);
}
  

// STEP 3: Get the classification!
function gotResults(error, results) {
  if (error) {
    console.error(error);
    return;
  }
  // Store the label
  label = results[0].label;
}
var a= [];
var asthama=0;
var covid=0;
var normal=0;
var cw=0;
function draw()
{

console.log(label);
a.push(label);
}
function starts()
{
a=[];
asthama=0;
covid=0;
normal=0;
cw=0;
loop();
document.getElementById("s").innerHTML="Status: Now Recording";


}
function stops()
{
noLoop();
document.getElementById("s").innerHTML="Status: Recorded";

console.log("Printing:");
for (var i=0;i<a.length;i++)
{
if(a[i]=="Normal")
{
normal++;
}
if(a[i]=="Wheezes")
{
asthama++;
}
if(a[i]=="Crackles")
{
cw++;
}
if(a[i]=="Pneumonia(Suspected Covid-19)")
{
covid++;
}
 

}
result="Normal"
max=normal
if(asthama>max)
{
max=asthama;
result="Wheezes"
}
if(covid>max)
{
max=covid;
result="Pneumonia(Suspected Covid-19)"
}
if(cw>max)
{ 
max=cw;
result="Crackles"

}

document.getElementById("result").innerHTML="Result:"+result;
console.log("Result:"+result);
}

  </script>
  <center>
<h2> Covid-19 Diagnostic Management System</h2>
<h3>(Breath Sound Recording)</h3>
<hr>
  
    <form>  
	Start Recording Breath Sound:
  <input type="button" onclick="starts()" value="Start"></input> <br><br>
  Stop Recording Breath Sound:
  <input type="button" onclick="stops()" value="Stop"></input>
  <h2 id="result">Result:</h2>
  <h3 id="s">Status:</h3>
  </form>
  </center>
</body>

</html>